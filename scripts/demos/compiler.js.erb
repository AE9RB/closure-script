<% args = %w{
  --summary_detail_level 3
  --define goog.DEBUG=false
  --warning_level VERBOSE
  --ns googly
}

args << case query_string
when 'build': %w{
  --compilation_level ADVANCED_OPTIMIZATIONS
  --js_output_file compiler.build
  --create_source_map compiler.map
}
when 'debug': %w{
  --debug true
  --formatting PRETTY_PRINT
  --compilation_level ADVANCED_OPTIMIZATIONS
  --js_output_file compiler.debug
}
end

goog.soy_to_js %w{
  --shouldProvideRequireSoyNamespaces
  --cssHandlingScheme goog
  --shouldGenerateJsdoc
  --outputPathFormat {INPUT_DIRECTORY}{INPUT_FILE_NAME_NO_EXT}.js
  **/*.soy
}

@response = goog.compile(args.flatten).to_response %>